<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>curl模块常用问题</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META name=GENERATOR content="MSHTML 8.00.6001.23580"></HEAD>
<BODY>
<P>curl模块常用问题</P>
<P>centos系统下</P>
<P>安装：<FONT color=#ff0000><STRONG>yum install curl 
curl-devel</STRONG></FONT></P>
<P>安装完就可以用了，默认安装的是7.19.7</P>
<P>问题1：</P>
<P><STRONG>可以抓外网的页面，抓不到局域网的（问题是防火墙阻拦了。）</STRONG></P>
<P>问题2:</P>
<P><STRONG>地址带端口号会出现拒绝访问（命令行执行不会）</STRONG></P>
<P><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">经常在查找资料，发现出现这个问题的原因是由于服务器开启了SElinux并且运行模式为强制模式时才会出现。</SPAN><BR 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">解决的方法就是交SElinux的运行模式切换为宽松模式。</SPAN><BR 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">操作方法如下：</SPAN><BR 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">#<STRONG><FONT 
color=#ff0000>setenforce 0&nbsp;&nbsp;&nbsp;&nbsp; 
这是临时方案，重启就无效了。可修改配置文件/etc/sysconfig/selinux&nbsp; 把SELINUX=permissive 或者 
disabled&nbsp;</FONT></STRONG></SPAN><BR 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">#<FONT 
color=#ff0000><STRONG>getenforce</STRONG></FONT></SPAN></P>
<P><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"></SPAN>&nbsp;</P>
<P><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">其它可以出现的问题：</SPAN></P><SPAN 
style="TEXT-ALIGN: left; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 26px; DISPLAY: inline !important; FONT: 13px/23px 'Microsoft Yahei', 宋体, 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif; WHITE-SPACE: normal; FLOAT: none; LETTER-SPACING: normal; COLOR: rgb(68,68,68); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><EM 
style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: 12px/18px 宋体, tahoma, Srial, helvetica, sans-serif; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(1,1,1); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><EM 
style="FONT-STYLE: normal">
<DIV 
style="LINE-HEIGHT: 24px; MARGIN-TOP: 10px; WIDTH: 570px; WHITE-SPACE: normal; MARGIN-LEFT: auto; FONT-SIZE: 14px; OVERFLOW: hidden; MARGIN-RIGHT: auto" 
id=text>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">一、在SHELL环境下，通过curl命令无法获取远程数据，出现error:couldn't 
connect to host找不到主机的解决方案。</P>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">iptables 
-A OUTPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT<BR></P>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">意思是，所有外出的请求目标的80端口授权。</P>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">之后curl 
远程url就肯定能成功。</P>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">二、php操作Curl（http,https）无法获取远程数据<SPAN 
style="WIDTH: auto; FLOAT: none; HEIGHT: auto" id=1_nwp><A 
style="COLOR: rgb(90,128,238); TEXT-DECORATION: none" id=1_nwl 
href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&u=http%3A%2F%2Fwww%2Eth7%2Ecn%2Fsystem%2Flin%2F201406%2F59875%2Eshtml&p=baidu&c=news&n=10&t=tpclicked3_hc&q=smileking_cpr&k=%BD%E2%BE%F6%B7%BD%B0%B8&k0=shell&kdi0=8&k1=%BD%E2%BE%F6%B7%BD%B0%B8&kdi1=8&k2=php&kdi2=8&k3=new&kdi3=8&k4=ssh&kdi4=8&k5=php%2Bmysql&kdi5=8&sid=7b538baf50649a30&ch=0&tu=u1682280&jk=2fd4afecfd0f6a71&cf=29&fv=15&stid=9&urlid=0&luki=2&seller_id=1&di=128" 
target=_blank mpid="1"><SPAN 
style="WIDTH: auto; FLOAT: none; HEIGHT: auto; COLOR: rgb(0,0,255); FONT-SIZE: 14px">解决方案</SPAN></A></SPAN></P>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">iptables&nbsp;-A 
OUTPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT</P>
<P 
style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 25px; MARGIN: 15px auto 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px">如果在SHELL下curl是正常的，在<SPAN 
style="WIDTH: auto; FLOAT: none; HEIGHT: auto" id=0_nwp><A 
style="COLOR: rgb(90,128,238); TEXT-DECORATION: none" id=0_nwl 
href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&u=http%3A%2F%2Fwww%2Eth7%2Ecn%2Fsystem%2Flin%2F201406%2F59875%2Eshtml&p=baidu&c=news&n=10&t=tpclicked3_hc&q=smileking_cpr&k=php&k0=shell&kdi0=8&k1=%BD%E2%BE%F6%B7%BD%B0%B8&kdi1=8&k2=php&kdi2=8&k3=new&kdi3=8&k4=ssh&kdi4=8&k5=php%2Bmysql&kdi5=8&sid=7b538baf50649a30&ch=0&tu=u1682280&jk=2fd4afecfd0f6a71&cf=29&fv=15&stid=9&urlid=0&luki=3&seller_id=1&di=128" 
target=_blank mpid="0"><SPAN 
style="WIDTH: auto; FLOAT: none; HEIGHT: auto; COLOR: rgb(0,0,255); FONT-SIZE: 14px">php</SPAN></A></SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>curl也必然正常，但是请求https 
SSH就未必正常，因为需要开启OUTPUT SSH端口443。</P></DIV></EM></EM></SPAN></BODY></HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>纯js ajax</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META name=GENERATOR content="MSHTML 11.00.9600.18057">
</HEAD>
<BODY>
<P>纯js ajax</P><PRE style="WORD-WRAP: break-word; MARGIN-BOTTOM: 0px; WHITE-SPACE: pre-wrap; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); FONT: 12px 'Courier New'; WIDOWS: 1; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px"><SPAN style="FONT-SIZE: 12px !important; FONT-FAMILY: 'Courier New' !important; COLOR: rgb(0,0,0); LINE-HEIGHT: 1.5 !important"><PRE style="FONT-SIZE: 10.5pt; FONT-FAMILY: '宋体'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN>xhrFactory = <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>() {<BR>   <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">init</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">apply</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">arguments</SPAN>);<BR>};<BR>xhrFactory.<SPAN style="FONT-WEIGHT: bold">prototype </SPAN>= {<BR>   <SPAN style="COLOR: #95c995; FONT-STYLE: italic">init</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>() {<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">create</SPAN>();<BR>   },<BR>   <SPAN style="COLOR: #808080; FONT-STYLE: italic">//创建对象<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">create</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>() {<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">xhr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">null</SPAN>;<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">try </SPAN>{<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if </SPAN>(<SPAN style="FONT-WEIGHT: bold">window</SPAN>.XMLHttpRequest) {<BR>            <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">xhr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN>XMLHttpRequest();<BR>         }<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">else if </SPAN>(<SPAN style="FONT-WEIGHT: bold">window</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">ActiveXObject</SPAN>) {<BR>            <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">xhr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">ActiveXObject</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"Msxml2.Xmlhttp"</SPAN>);<BR>         }<BR>      }<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">catch </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">xhr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">ActiveXObject</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"Microsoft.Xmlhttp"</SPAN>);<BR>      }<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">return </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">xhr</SPAN>;<BR>   },<BR>   <SPAN style="COLOR: #808080; FONT-STYLE: italic">//onreadystatechange句柄:<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   /*readyState  : 1.创建MLHTTP对象   2.打开与服务器的连接  3 .发送指令   4  等待处理请求结果 ;<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   * status:  200.请求成功   400.请求错误。。。还有很多值 ;<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   * timeout参数是请求过期时间 ;<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   * callback参数，回调对返回数据做了处理，转换成对象。<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   */<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">readystate</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>) {<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">onreadystatechange </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>() {<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">readyState </SPAN>== <SPAN style="COLOR: #6666d9">4</SPAN>){<BR>            <SPAN style="COLOR: #808080; FONT-STYLE: italic">/*var responseText = this.responseText;<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            var responseXML = this.responseXML;<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            var status = this.status;<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            if(this.status == 200){<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">               opt.success(responseText,responseXML)<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            }else{<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">               opt.error(responseText,status)<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            };*/<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            //this.status===200 ?opt.success(this.responseText,this.responseXML):opt.error(this.responseText,this.status);<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">         </SPAN>}<BR>      }<BR>   },<BR>   <SPAN style="COLOR: #808080; FONT-STYLE: italic">//拼接参数<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">para</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">data</SPAN>) {<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">typeof </SPAN><SPAN style="COLOR: #99ff99">data </SPAN>== <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'object'</SPAN>){<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">str </SPAN>= <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">''</SPAN>;<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">for</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">i </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">in </SPAN><SPAN style="COLOR: #99ff99">data</SPAN>){<BR>            <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">str </SPAN>+= <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"&amp;"</SPAN>+<SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">i</SPAN>+<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"="</SPAN>+<SPAN style="COLOR: #95c995; FONT-STYLE: italic">encodeURIComponent</SPAN>(<SPAN style="COLOR: #99ff99">data</SPAN>[<SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">i</SPAN>]);<BR>         }<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">return </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">str</SPAN>.<SPAN style="FONT-WEIGHT: bold">length</SPAN>==<SPAN style="COLOR: #6666d9">0 </SPAN>? <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">str </SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">str</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">substring</SPAN>(<SPAN style="COLOR: #6666d9">1</SPAN>);<BR>      }<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">else</SPAN>{<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">return </SPAN><SPAN style="COLOR: #99ff99">data</SPAN>;<BR>      }<BR>   },<BR>   <SPAN style="COLOR: #808080; FONT-STYLE: italic">//get方法<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   //{'url':'', 'data':'', 'success':'','error':'','async':true}<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">get</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>) {<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newurl </SPAN>= <SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">url</SPAN>;<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if</SPAN>(!!<SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">data</SPAN>){<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">datastr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">para</SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">data</SPAN>);<BR>         <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newurl </SPAN>= <SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">url </SPAN>+ <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"?"</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>+ <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">datastr</SPAN>;<BR>      }<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">open</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"get"</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newurl</SPAN>, !<SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="FONT-WEIGHT: bold">async </SPAN>? <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">true </SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">false</SPAN>);<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">send</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">null</SPAN>);<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">readystate</SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>);<BR>   },<BR>   <SPAN style="COLOR: #808080; FONT-STYLE: italic">//post方法<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   //{'url':'', 'data':'', 'success':'','error':'','async':true}<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">   </SPAN><SPAN style="COLOR: #95c995; FONT-STYLE: italic">post</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>) {<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newurl </SPAN>= <SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">url</SPAN>;<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">datastr </SPAN>= !!<SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">data</SPAN>?<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">para</SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">data</SPAN>):<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">null</SPAN>;<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">open</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"post"</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newurl</SPAN>, !<SPAN style="FONT-WEIGHT: bold">async </SPAN>? <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">true </SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">false</SPAN>);<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">setRequestHeader</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"content-type"</SPAN>, <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"x-www-form-urlencoded"</SPAN>);<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">send</SPAN>(!<SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">datastr </SPAN>? <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">null </SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">datastr</SPAN>);<BR>      <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">readystate</SPAN>(<SPAN style="COLOR: #99ff99">opt</SPAN>);<BR>   }<BR>};<BR><SPAN style="COLOR: #808080; FONT-STYLE: italic">//调用<BR></SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var  </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">xhr </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN>xhrFactory();<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">xhr</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">get</SPAN>({<BR>   <SPAN style="FONT-WEIGHT: bold">url</SPAN>:<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'exporter.xml'</SPAN>,<BR>   <SPAN style="FONT-WEIGHT: bold">data</SPAN>:<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"a=123"</SPAN>,<BR>   <SPAN style="COLOR: #95c995; FONT-STYLE: italic">success</SPAN>:<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(<SPAN style="COLOR: #99ff99">data</SPAN>){<BR>      <SPAN style="FONT-WEIGHT: bold">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #99ff99">data</SPAN>);<BR>   },<BR>   <SPAN style="COLOR: #95c995; FONT-STYLE: italic">error</SPAN>:<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(){<BR>      <SPAN style="FONT-WEIGHT: bold">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'出错了！'</SPAN>);<BR>   }<BR>});<BR><BR></PRE></SPAN></PRE></BODY></HTML>
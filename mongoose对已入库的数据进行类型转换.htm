<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>mongoose对已入库的数据进行类型转换</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META name=GENERATOR content="MSHTML 11.00.9600.17801"></HEAD>
<BODY>
<P>mongoose对已入库的数据进行类型转换</P><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd"><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd"></SPAN>&nbsp;</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">mongoose </SPAN>= require(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'mongoose'</SPAN>);<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">imDb </SPAN>= require(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'./Db'</SPAN>);</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><BR><BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">imDb</SPAN>.<SPAN style="FONT-WEIGHT: bold">Db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">on</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'open'</SPAN>,<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(){<SPAN style="COLOR: #808080; FONT-STYLE: italic">//</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">成功连接数据库</SPAN><BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">ims </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">imDb</SPAN>.<SPAN style="FONT-WEIGHT: bold">Db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">collection</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"ims"</SPAN>);<SPAN style="COLOR: #808080; FONT-STYLE: italic">//</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">使用</SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">ims</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">表<BR></SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">    </SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">//</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">对已入库的数据进行类型转换</SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">(</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">互转</SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">)<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">    </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">ims</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">find</SPAN>({<SPAN style="FONT-WEIGHT: bold">activate</SPAN>:{<SPAN style="FONT-WEIGHT: bold">$type</SPAN>:<SPAN style="COLOR: #6666d9">16</SPAN>}}).<SPAN style="COLOR: #95c995; FONT-STYLE: italic">toArray</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>, <SPAN style="COLOR: #99ff99">documents</SPAN>) {<BR>        <SPAN style="COLOR: #99ff99">documents</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">forEach</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(<SPAN style="COLOR: #99ff99">doc</SPAN>){<BR>            <SPAN style="COLOR: #99ff99">doc</SPAN>.<SPAN style="FONT-WEIGHT: bold">activate </SPAN>= Boolean(<SPAN style="COLOR: #99ff99">doc</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">activate</SPAN>);<BR>            <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">ims</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">save</SPAN>(<SPAN style="COLOR: #99ff99">doc</SPAN>,<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(){<BR>                <SPAN style="FONT-WEIGHT: bold">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #99ff99">documents</SPAN>);<BR>            });<BR>        })<BR>    });<BR>     <SPAN style="COLOR: #808080; FONT-STYLE: italic">/*ims.find({activate:{$type:8}}).toArray(function(err, documents) {<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">        documents.forEach(function(doc){<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            doc.activate = Number(doc.activate);<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            ims.save(doc,function(){<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">                console.log(documents);<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">            });<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">        })<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">    });*/<BR></SPAN>});</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><BR>&nbsp;</PRE></SPAN></PRE></BODY></HTML>

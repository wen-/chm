<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=gb2312">
<META name="GENERATOR" content="QuickCHM">
<TITLE>iptables详解</TITLE>
</HEAD>
<BODY>
<P>iptables详解</P>
<DIV id=blogBody class=blog-body 
style='FONT-SIZE: 16px; WORD-WRAP: break-word; FONT-FAMILY: "Pingfang SC", STHeiti, "Lantinghei SC", "Open Sans", Arial, "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", SimSun, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 30px; POSITION: relative; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(61,70,77); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 28px; BACKGROUND-COLOR: rgb(248,248,248); TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-tap-highlight-color: transparent'>
<DIV class=BlogContent style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">觉得有用请顶一下，谢谢</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><IMG 
src="images/193925_cNWe_874335.png" align=baseline><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">Filter</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">表：过滤数据包，默认表</B>。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（1）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">INPUT&nbsp;&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>链：过滤所有目标地址是本机的数据包（对进入本机数据包的过滤）<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（2）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">OUTPUT<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>链：过滤所有本机产生的数据包（对源地址得数据包的过滤）<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（3）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">FORWARD</SPAN>链：过滤所有路过本机的数据包（源地址和目标地址都不是本机的数据包。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">NAT</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">表：网络地址转换（</B><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">Network Address 
Translation</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">）</B><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">如果第一个数据包允许经行<SPAN 
style="-webkit-tap-highlight-color: transparent">NAT</SPAN>或<SPAN 
style="-webkit-tap-highlight-color: transparent">Masquerade,</SPAN>那么其它数据包都会被做相同的动作，也就是其他数据包不会被一个一个地<SPAN 
style="-webkit-tap-highlight-color: transparent">NAT</SPAN>（属于一个流的包只会经过这个表一次）任何时候都不要在这个表任何一条链经行过滤。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">&nbsp;&nbsp;&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>包括三个动作<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（1）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">DNAT</SPAN>：改变数据包的目的地址使包能重路由到某台机器<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>（使公网能够访问局域网的服务器）<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（2）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">SNAT:<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>改变数据包的源地址（使局域网能访问公网）<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（3）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">NASQUERADE:</SPAN>和<SPAN 
style="-webkit-tap-highlight-color: transparent">SNAT</SPAN>一样使局域网能访问公网，无固定<SPAN 
style="-webkit-tap-highlight-color: transparent">IP</SPAN>使用<SPAN 
style="-webkit-tap-highlight-color: transparent">PPP.PPPoE</SPAN>等拨号上网接入<SPAN 
style="-webkit-tap-highlight-color: transparent">Internet</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">Nat</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">表包含</B><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">3</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">条链：</B><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（1）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">PREROUTING</SPAN>链<SPAN 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>:</SPAN>数据包到达防火墙时改变包的目的地址。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（2）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">OUTPUT</SPAN>链：改变本地产生数据包的目标地址。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（3）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">POSTROUTING:</SPAN>在数据包离开防火墙时改变数据包的源地址。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">Mangle</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">表：修改数据包，改变包头中内容</B><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">(TTL, TOS,&nbsp; MARK 
)</SPAN></B></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">(1)</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">TOS 
:</SPAN>设置改变数据包的服务类型，不要使用<SPAN 
style="-webkit-tap-highlight-color: transparent">TOS</SPAN>设置发往<SPAN 
style="-webkit-tap-highlight-color: transparent">Internet</SPAN>的包除非打算依赖<SPAN 
style="-webkit-tap-highlight-color: transparent">TOS</SPAN>来路由，不能在表中配置任何过滤。<SPAN 
style="-webkit-tap-highlight-color: transparent">SNAT</SPAN>、<SPAN 
style="-webkit-tap-highlight-color: transparent">DNAT</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">(2)</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">TTL:</SPAN>改变数据包的生存时间，可以让数据包只有一个特殊的<SPAN 
style="-webkit-tap-highlight-color: transparent">TTL</SPAN>，欺骗<SPAN 
style="-webkit-tap-highlight-color: transparent">ISP,</SPAN>有些<SPAN 
style="-webkit-tap-highlight-color: transparent">ISP</SPAN>并不希望多台计算机共享一个连接访问<SPAN 
style="-webkit-tap-highlight-color: transparent">Internet,ISP</SPAN>通过检查一台计算机所发出的数据包是否含有不同的<SPAN 
style="-webkit-tap-highlight-color: transparent">TTL</SPAN>来判断。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">(3)</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">Mask:</SPAN>给数据包设置特殊的标记，通过标记配置带宽限制和基于请求分类。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">Mangle</SPAN>表的<SPAN 
style="-webkit-tap-highlight-color: transparent">5</SPAN>条链：<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（1）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">PREROUTING&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>链：数据包进入防火墙后，路由判断之前改变数据包。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（2）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">POSTROUTING</SPAN>链：数据包确定了目标地址后，即路由判断前改变数据包。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（3）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">OUTPUT</SPAN>链：在数据包被确定目的地址前改变数据包<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（4）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">INPUT</SPAN>链：在数据包进入本机后，应用程序接受之前改变数据包。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（5）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">FORWARD</SPAN>链：第一次路由判断之后，最后一次路由判断前改变数据包。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">IPTABLES</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">中数据包和</B><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">4</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">种被跟踪连接的</B><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">4</SPAN></B><B 
style="-webkit-tap-highlight-color: transparent">种不同状态。</B><B 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></B></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（1）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">NEW :<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>该包想要开始一个连接（重新连接或将连接重定向）<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（2）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">RELATED:</SPAN>该包是属于某个已经建立的连接所建立的新连接。例如：<SPAN 
style="-webkit-tap-highlight-color: transparent">FTP</SPAN>的数据传输连接就是控制连接所<SPAN 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>RELATED</SPAN>出来的连接。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">--icmp-type&nbsp; 0 ( ping<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>应答<SPAN 
style="-webkit-tap-highlight-color: transparent">)<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>就是<SPAN 
style="-webkit-tap-highlight-color: transparent">--icmp-type 8 (ping<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN>请求<SPAN 
style="-webkit-tap-highlight-color: transparent">)</SPAN>所<SPAN 
style="-webkit-tap-highlight-color: transparent">RELATED</SPAN>出来的<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">（3）</SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent">ESTABLISHED 
:</SPAN>只要发送并接到应答，一个数据连接从<SPAN 
style="-webkit-tap-highlight-color: transparent">NEW</SPAN>变为<SPAN 
style="-webkit-tap-highlight-color: transparent">ESTABLISHED,</SPAN>而且该状态会继续匹配这个连接的后续数据包。<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>INVALID:数据包不能被识别属于哪个连接或没有任何状态比如内存溢出，收到不知属于哪个连接的ICMP错误信息，一般应该DROP这个状态的任何数据。<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">常用命令列表：</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-A, --append</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT ...</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
新增规则到某个规则炼中，该规则将会成为规则炼中的最后一条规则。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-D, --delete</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -D INPUT --dport 80 -j DROP</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">iptables 
-D INPUT 1&nbsp;</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
从某个规则炼中删除一条规则，可以输入完整规则，或直接指定规则编号加以删除。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-R, --replace</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -R INPUT 1 -s 192.168.0.1 -j DROP</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
取代现行规则，规则被取代后并不会改变顺序。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-I, --insert</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -I INPUT 1 --dport 80 -j ACCEPT</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
插入一条规则，原本该位置上的规则将会往后移动一个顺位。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-L, --list</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -L INPUT</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
列出某规则炼中的所有规则。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-F, --flush</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -F INPUT</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
删除某规则炼中的所有规则。&nbsp;</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-Z, --zero</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -Z INPUT</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
将封包计数器归零。封包计数器是用来计算同一封包出现次数，是过滤阻断式攻击不可或缺的工具。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-N, --new-chain</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -N allowed</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
定义新的规则炼。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-X, --delete-chain</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -X allowed</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
删除某个规则炼。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-P, --policy</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -P INPUT DROP</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
定义过滤政策。 也就是未符合过滤条件之封包，预设的处理方式。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">命令 
-E, --rename-chain</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -E allowed disallowed</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
修改某自订规则炼的名称。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">常用封包比对参数：</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-p, --protocol</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p tcp</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
比对通讯协议类型是否相符，可以使用 ! 运算子进行反向比对，例如：-p ! tcp ，意思是指除 tcp 以外的其它类型，包含 udp、icmp 
...等。如果要比对所有类型，则可以使用 all 关键词，例如：-p all。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-s, --src, --source</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -s 192.168.1.1</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对封包的来源 IP，可以比对单机或网络，比对网络时请用数字来表示屏蔽，例如：-s 192.168.0.0/24，比对 IP 时也可以使用 ! 
运算子进行反向比对，例如：-s ! 192.168.0.0/24。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">参数 
-d, --dst, --destination</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -d 192.168.1.1</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对封包的目的地 IP，设定方式同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">参数 
-i, --in-interface</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -i eth0</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对封包是从哪片网卡进入，可以使用通配字符 + 来做大范围比对，例如：-i eth+ 表示所有的 ethernet 网卡，也可以使用 ! 
运算子进行反向比对，例如：-i ! eth0。&nbsp;</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-o, --out-interface</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A FORWARD -o eth0</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对封包要从哪片网卡送出，设定方式同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--sport, --source-port</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p tcp --sport 22</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">说明 
用来比对封包的来源埠号，可以比对单一埠，或是一个范围，例如：--sport 22:80，表示从 22 到 80</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">埠之间都算是符合条件，如果要比对不连续的多个埠，则必须使用 
--multiport 参数，详见后文。比对埠号时，可以使用 !</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">运算子进行反向比对。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--dport, --destination-port</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p tcp --dport 22</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对封包的目的地埠号，设定方式同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--tcp-flags</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -p tcp --tcp-flags SYN,FIN,ACK SYN</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">说明 
比对 TCP</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">封包的状态旗号，参数分为两个部分，第一个部分列举出想比对的旗号，第二部分则列举前述旗号中哪些有被设定，未被列举的旗号必须是空的。TCP</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">状态旗号包括：SYN（同步）、ACK（应答）、FIN（结束）、RST（重设）、URG（紧急）、PSH（强迫推送）</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">等均可使用于参数中，除此之外还可以使用关键词 
ALL 和 NONE 进行比对。比对旗号时，可以使用 ! 运算子进行反向比对。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--syn</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -p tcp --syn</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对是否为要求联机之 TCP 封包，与 iptables -p tcp --tcp-flags SYN,FIN,ACK SYN 的作用完全相同，如果使用 ! 
运算子，可用来比对非要求联机封包。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m multiport --source-port</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p tcp -m multiport --source-port 22,53,80,110</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对不连续的多个来源埠号，一次最多可以比对 15 个埠，可以使用 ! 运算子进行反向比对。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m multiport --destination-port</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p tcp -m multiport --destination-port 
22,53,80,110</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对不连续的多个目的地埠号，设定方式同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m multiport --port</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p tcp -m multiport --port 22,53,80,110</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
这个参数比较特殊，用来比对来源埠号和目的埠号相同的封包，设定方式同上。注意：在本范例中，如果来源端口号为 80 但目的地埠号为 
110，这种封包并不算符合条件。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--icmp-type</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -p icmp --icmp-type 8</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对 ICMP 的类型编号，可以使用代码或数字编号来进行比对。请打 iptables -p icmp --help 
来查看有哪些代码可以用。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m limit --limit</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -m limit --limit 3/hour</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">说明 
用来比对某段时间内封包的平均流量，上面的例子是用来比对：每小时平均流量是否超过一次 3 个封包。</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">除了每小时平均一次外，也可以每秒钟、每分钟或每天平均一次，默认值为每小时平均一次，参数如后： 
/second、 /minute、/day。</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">除了进行封包数量的比对外，设定这个参数也会在条件达成时，暂停封包的比对动作，以避免因骇客使用洪水攻击法，导致服务被阻断。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--limit-burst</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -m limit --limit-burst 5</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对瞬间大量封包的数量，上面的例子是用来比对一次同时涌入的封包是否超过 5 
个（这是默认值），超过此上限的封包将被直接丢弃。使用效果同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m mac --mac-source</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -m mac --mac-source 00:00:00:00:00:01</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">说明 
用来比对封包来源网络接口的硬件地址，这个参数不能用在 OUTPUT 和 Postrouting</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">规则炼上，这是因为封包要送出到网卡后，才能由网卡驱动程序透过 
ARP 通讯协议查出目的地的 MAC 地址，所以 iptables</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">在进行封包比对时，并不知道封包会送到哪个网络接口去。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
--mark</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -t mangle -A INPUT -m mark --mark 1</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对封包是否被表示某个号码，当封包被比对成功时，我们可以透过 MARK 处理动作，将该封包标示一个号码，号码最大不可以超过 
4294967296。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m owner --uid-owner</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A OUTPUT -m owner --uid-owner 500</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对来自本机的封包，是否为某特定使用者所产生的，这样可以避免服务器使用 root 
或其它身分将敏感数据传送出去，可以降低系统被骇的损失。可惜这个功能无法比对出来自其它主机的封包。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m owner --gid-owner</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A OUTPUT -m owner --gid-owner 0</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对来自本机的封包，是否为某特定使用者群组所产生的，使用时机同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m owner --pid-owner</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A OUTPUT -m owner --pid-owner 78</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对来自本机的封包，是否为某特定行程所产生的，使用时机同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m owner --sid-owner</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A OUTPUT -m owner --sid-owner 100</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">说明 
用来比对来自本机的封包，是否为某特定联机（Session ID）的响应封包，使用时机同上。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">参数 
-m state --state</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例 
iptables -A INPUT -m state --state RELATED,ESTABLISHED&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">说明 
用来比对联机状态，联机状态共有四种：INVALID、ESTABLISHED、NEW 和 RELATED。</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">INVALID 
表示该封包的联机编号（Session ID）无法辨识或编号不正确。</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">ESTABLISHED 
表示该封包属于某个已经建立的联机。</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">NEW 
表示该封包想要起始一个联机（重设联机或将联机重导向）。&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">RELATED 
表示该封包是属于某个已经建立的联机，所建立的新联机。例如：FTP-DATA 联机必定是源自某个 FTP 联机。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">常用的处理动作：</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">-j 
参数用来指定要进行的处理动作，常用的处理动作包括：ACCEPT、REJECT、DROP、REDIRECT、MASQUERADE、LOG、DNAT、SNAT、MIRROR、QUEUE、RETURN、MARK，分别说明如下：</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">ACCEPT 
将封包放行，进行完此处理动作后，将不再比对其它规则，直接跳往下一个规则炼（nat:postrouting）。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">REJECT 
拦阻该封包，并传送封包通知对方，可以传送的封包有几个选择：ICMP port-unreachable、ICMP</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">echo-reply 
或是 tcp-reset（这个封包会要求对方关闭联机），进行完此处理动作后，将不再比对其它规则，直接 中断过滤程序。</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">范例如下：</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">iptables 
-A FORWARD -p TCP --dport 22 -j REJECT --reject-with tcp-reset</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">DROP 
丢弃封包不予处理，进行完此处理动作后，将不再比对其它规则，直接中断过滤程序。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">REDIRECT 
将封包重新导向到另一个端口（PNAT），进行完此处理动作后，将 会继续比对其它规则。 这个功能可以用来实作通透式 porxy</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">或用来保护 
web 服务器。例如：iptables -t nat -A PREROUTING -p tcp --dport 80 -j</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">REDIRECT 
--to-ports 8080</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">MASQUERADE 
改写封包来源 IP 为防火墙 NIC IP，可以指定 port</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">对应的范围，进行完此处理动作后，直接跳往下一个规则炼（mangle:postrouting）。这个功能与 
SNAT 略有不同，当进行 IP</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">伪装时，不需指定要伪装成哪个 
IP，IP 会从网卡直接读取，当使用拨接连线时，IP 通常是由 ISP 公司的 DHCP 服务器指派的，这个时候</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">MASQUERADE 
特别有用。范例如下：</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">iptables 
-t nat -A POSTROUTING -p TCP -j MASQUERADE --to-ports 1024-31000</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">LOG 
将封包相关讯息纪录在 /var/log 中，详细位置请查阅 /etc/syslog.conf 
组态档，进行完此处理动作后，将会继续比对其它规则。例如：</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">iptables 
-A INPUT -p tcp -j LOG --log-prefix "INPUT packets"</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">SNAT 
改写封包来源 IP 为某特定 IP 或 IP 范围，可以指定 port 
对应的范围，进行完此处理动作后，将直接跳往下一个规则炼（mangle:postrouting）。范例如下：</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">iptables 
-t nat -A POSTROUTING -p tcp-o eth0 -j SNAT --to-source 
194.236.50.155-194.236.50.160:1024-32000</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">DNAT 
改写封包目的地 IP 为某特定 IP 或 IP 范围，可以指定 port 对应的范围，进行完此处理动作后，将会直接跳往下一个规则炼（filter:input 或 
filter:forward）。范例如下：</SPAN><SPAN class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">iptables 
-t nat -A PREROUTING -p tcp -d 15.45.23.67 --dport 80 -j DNAT --to-destination 
192.168.1.1-192.168.1.10:80-100</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">MIRROR 
镜射封包，也就是将来源 IP 与目的地 IP 对调后，将封包送回，进行完此处理动作后，将会中断过滤程序。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">QUEUE 
中断过滤程序，将封包放入队列，交给其它程序处理。透过自行开发的处理程序，可以进行其它应用，例如：计算联机费用.......等。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">RETURN 
结束在目前规则炼中的过滤程序，返回主规则炼继续过滤，如果把自订规则炼看成是一个子程序，那么这个动作，就相当于提早结束子程序并返回到主程序中。</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></P><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">MARK 
将封包标上某个代号，以便提供作为后续过滤的条件判断依据，进行完此处理动作后，将会继续比对其它规则。范例如下：</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><SPAN 
style="FONT-SIZE: 14px; FONT-FAMILY: Verdana, sans-serif, 宋体; LINE-HEIGHT: normal; BACKGROUND-COLOR: rgb(255,255,255); -webkit-tap-highlight-color: transparent">&nbsp;</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; -webkit-tap-highlight-color: transparent">iptables 
-t mangle -A PREROUTING -p tcp --dport 22 -j MARK --set-mark 2</SPAN></P>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">开始实验</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></P>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如果你的IPTABLES基础知识还不了解,建议先去看看.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">开始配置</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">我们来配置一个filter表的防火墙.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">(1)查看本机关于IPTABLES的设置情况 
默认查看INPUT FORWARD OUTPUT三个表的策略。</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">[root@tp ~]# iptables -L 
-n</SPAN>&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">Chain INPUT (policy 
ACCEPT)&nbsp; Chain INPUT (policy DROP)<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">target &nbsp; &nbsp; prot opt 
source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">ACCEPT &nbsp; &nbsp; all 
&nbsp;-- &nbsp;0.0.0.0/0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">ACCEPT &nbsp; &nbsp; tcp 
&nbsp;-- &nbsp;192.168.181.34 &nbsp; &nbsp; &nbsp; 0.0.0.0/0 &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; tcp dpt:22<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">ACCEPT &nbsp; &nbsp; tcp 
&nbsp;-- &nbsp;192.168.181.35 &nbsp; &nbsp; &nbsp; 0.0.0.0/0 &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; tcp dpt:22<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">ACCEPT &nbsp; &nbsp; tcp 
&nbsp;-- &nbsp;0.0.0.0/0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp dpt:80<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent">Chain FORWARD (policy 
DROP)<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">target &nbsp; &nbsp; prot opt 
source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent">Chain OUTPUT (policy DROP)<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">target &nbsp; &nbsp; prot opt 
source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">ACCEPT &nbsp; &nbsp; all 
&nbsp;-- &nbsp;0.0.0.0/0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">ACCEPT &nbsp; &nbsp; tcp 
&nbsp;-- &nbsp;192.168.181.33 &nbsp; &nbsp; &nbsp; 0.0.0.0/0 &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; tcp spt:22<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">
<DIV style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></DIV></DIV>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">如果你在安装linux时没有选择启动防火墙,是这样的</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P><PRE class="brush:shell; toolbar: true; auto-links: false; hljs lisp" style='FONT-SIZE: 13px; WORD-WRAP: normal; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BACKGROUND: rgb(63,63,63); OVERFLOW-X: auto; COLOR: rgb(220,220,220); PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 2px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 2px; -webkit-tap-highlight-color: transparent; border-radius: 3px'><CODE class="hljs lisp" style='FONT-SIZE: 13px; WORD-WRAP: normal; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BACKGROUND: rgb(63,63,63); OVERFLOW-X: auto; COLOR: rgb(220,220,220); PADDING-BOTTOM: 10px; PADDING-TOP: 10px; PADDING-LEFT: 10px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 10px; -webkit-tap-highlight-color: transparent; border-radius: 4px'># iptables -L -n  

Chain INPUT (<SPAN class=hljs-name style="COLOR: rgb(239,239,143); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-name style="COLOR: rgb(239,239,143); -webkit-tap-highlight-color: transparent">policy</SPAN></SPAN> ACCEPT)  
target       prot opt source                 destination         
Chain FORWARD (<SPAN class=hljs-name style="COLOR: rgb(239,239,143); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-name style="COLOR: rgb(239,239,143); -webkit-tap-highlight-color: transparent">policy</SPAN></SPAN> ACCEPT)  
target       prot opt source                 destination         
Chain OUTPUT (<SPAN class=hljs-name style="COLOR: rgb(239,239,143); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-name style="COLOR: rgb(239,239,143); -webkit-tap-highlight-color: transparent">policy</SPAN></SPAN> ACCEPT)  
target       prot opt source                 destination</CODE></PRE>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P>
<DIV style="-webkit-tap-highlight-color: transparent">什么规则都没有.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">(2)清除原有规则.</STRONG></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">不管你在安装linux时是否启动了防火墙,如果你想配置属于自己的防火墙,那就清除现在filter的所有规则.</DIV>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN>[root@tp ~]# iptables 
-F</SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
清除预设表filter中的所有规则链的规则&nbsp;</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">[root@tp ~]# iptables 
-X</SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 清除预设表filter中使用者自定链中的规则</P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">[root@tp ~]# iptables 
-Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 清楚预设表filter中计数器</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></P>
<DIV style="-webkit-tap-highlight-color: transparent">我们在来看一下</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">[root@tp ~]# iptables -L 
-n</SPAN>&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">Chain INPUT (policy 
ACCEPT)&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
prot opt 
source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">Chain FORWARD (policy 
ACCEPT)&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
prot opt 
source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">Chain OUTPUT (policy 
ACCEPT)&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
prot opt 
source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">什么都没有了吧,和我们在安装linux时没有启动防火墙是一样的.(提前说一句,这些配置就像用命令配置IP一样,重起就会失去作用),怎么保存.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 18px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">[root@tp 
~]#&nbsp;</SPAN>/etc/rc.d/init.d/iptables save</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 18px; -webkit-tap-highlight-color: transparent">这样就可以写到/etc/sysconfig/iptables文件里了.写入后记得把防火墙重起一下,才能起作用.</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 18px; -webkit-tap-highlight-color: transparent">[root@tp 
~]# service iptables restart</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">现在IPTABLES配置表里什么配置都没有了,那我们开始我们的配置吧</DIV>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">(3)设定预设规则</STRONG></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><B 
style="-webkit-tap-highlight-color: transparent">到这最好做一个shellscript.</B></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P><PRE class="brush:shell; toolbar: true; auto-links: false; hljs bash" style='FONT-SIZE: 13px; WORD-WRAP: normal; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BACKGROUND: rgb(63,63,63); OVERFLOW-X: auto; COLOR: rgb(220,220,220); PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 2px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 2px; -webkit-tap-highlight-color: transparent; border-radius: 3px'><CODE class="hljs bash" style='FONT-SIZE: 13px; WORD-WRAP: normal; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BACKGROUND: rgb(63,63,63); OVERFLOW-X: auto; COLOR: rgb(220,220,220); PADDING-BOTTOM: 10px; PADDING-TOP: 10px; PADDING-LEFT: 10px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 10px; -webkit-tap-highlight-color: transparent; border-radius: 4px'><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"># vi ipt.sh</SPAN></SPAN>

<SPAN class=hljs-meta style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-meta style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent">#!/bin/bash</SPAN></SPAN>
<SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent">#iptables init</SPAN></SPAN>
<SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent">#---------------------------</SPAN></SPAN>
iptables -F
iptables -X
iptables -Z
<SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent">#set the default rules</SPAN></SPAN>
<SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent">#---------------------------</SPAN></SPAN>
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP 

<SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent">#---------------------------</SPAN></SPAN>
service iptables save
<SPAN class=hljs-built_in style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-built_in style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent">echo</SPAN></SPAN> <SPAN class=hljs-string style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-string style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent">"------------------------------------------------------------------------"</SPAN></SPAN>
iptables -L -n
<SPAN class=hljs-built_in style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-built_in style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent">echo</SPAN></SPAN> <SPAN class=hljs-string style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-string style="COLOR: rgb(204,147,147); -webkit-tap-highlight-color: transparent">"-------------------------------------------------------------------------"</SPAN></SPAN></CODE></PRE><PRE class="brush:shell; toolbar: true; auto-links: false; hljs bash" style='FONT-SIZE: 13px; WORD-WRAP: normal; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BACKGROUND: rgb(63,63,63); OVERFLOW-X: auto; COLOR: rgb(220,220,220); PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 2px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 2px; -webkit-tap-highlight-color: transparent; border-radius: 3px'><CODE class="hljs bash" style='FONT-SIZE: 13px; WORD-WRAP: normal; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BACKGROUND: rgb(63,63,63); OVERFLOW-X: auto; COLOR: rgb(220,220,220); PADDING-BOTTOM: 10px; PADDING-TOP: 10px; PADDING-LEFT: 10px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 10px; -webkit-tap-highlight-color: transparent; border-radius: 4px'><SPAN style="-webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"><SPAN class=hljs-comment style="COLOR: rgb(127,159,127); -webkit-tap-highlight-color: transparent"># bash ./ipt.sh</SPAN></SPAN></SPAN></CODE></PRE>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></P>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">上面的意思是,当超出了IPTABLES里filter表里的两个链规则(INPUT,FORWARD)时,不在这两个规则里的数据包怎么处理呢,那就是DROP(放弃).应该说这样配置是很安全的.我们要控制流入数据包</P>
<DIV 
style="-webkit-tap-highlight-color: transparent">而对于OUTPUT链,也就是流出的包我们不用做太多限制,而是采取ACCEPT,也就是说,不在着个规则里的包怎么办呢,那就是通过.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">注:如果你是远程SSH登陆的话,当你输入第一个命令回车的时候就应该掉了.因为你没有设置任何规则.</DIV>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">怎么办,去本机操作呗!</P>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">(4)添加规则.</STRONG></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">首先添加INPUT链,INPUT链的默认规则是DROP,所以我们就写需要ACCETP(通过)的链</DIV>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">为了能采用远程SSH登陆,我们要开启22端口.</P>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">到这块就和其他博客不一样了。</P>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">开启SSH所需要打开22端口</P>
<P 
style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent">iptables 
-A INPUT &nbsp;（-s 192.168.181.34） -p tcp --dport 22 -j ACCEPT #进入INPUT的来源IP<BR 
style="-webkit-tap-highlight-color: transparent">iptables -A OUTPUT （-s 
192.168.181.33） -p tcp --sport 22 -j ACCEPT #出去OUTPUT的来源IP（基本都是本机）<BR 
style="-webkit-tap-highlight-color: transparent"></P>
<DIV style="-webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></DIV><STRONG 
style="-webkit-tap-highlight-color: transparent">如果做了WEB服务器,开启80端口.</STRONG>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -p tcp 
--dport 80 -j ACCEPT</SPAN>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如果做了邮件服务器,开启25,110端口.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -p tcp 
--dport 110 -j ACCEPT<BR style="-webkit-tap-highlight-color: transparent"># 
iptables -A INPUT -p tcp --dport 25 -j ACCEPT</SPAN>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如果做了FTP服务器,开启21端口</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -p tcp 
--dport 21 -j ACCEPT</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -p tcp 
--dport 20 -j ACCEPT</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如果做了DNS服务器,开启53端口</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -p tcp 
--dport 53 -j ACCEPT</SPAN></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">如果你还做了其他的服务器,需要开启哪个端口,照写就行了.</DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">上面主要写的都是INPUT链,凡是不在上面的规则里的,都DROP</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">允许icmp包通过,也就是允许ping,</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A OUTPUT -p icmp -j 
ACCEPT (OUTPUT设置成DROP的话)</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -p icmp -j 
ACCEPT&nbsp;&nbsp;&nbsp; (INPUT设置成DROP的话)</SPAN>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent">
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">允许loopback!(不然会导致DNS无法正常关闭等问题)</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">IPTABLES -A INPUT -i lo -p all 
-j ACCEPT (如果是INPUT DROP)<BR 
style="-webkit-tap-highlight-color: transparent">IPTABLES -A OUTPUT -o lo -p all 
-j ACCEPT(如果是OUTPUT DROP)<BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></DIV></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">下面写OUTPUT链,OUTPUT链默认规则是ACCEPT,所以我们就写需要DROP(放弃)的链.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">减少不安全的端口连接</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A OUTPUT -p tcp 
--sport 31337 -j DROP</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A OUTPUT -p tcp 
--dport 31337 -j DROP</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">有些些特洛伊木马会扫描端口31337到31340(即黑客语言中的 
elite 
端口)上的服务。既然合法服务都不使用这些非标准端口来通信,阻塞这些端口能够有效地减少你的网络上可能被感染的机器和它们的远程主服务器进行独立通信的机会</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">还有其他端口也一样,像:31335、27444、27665、20034 
NetBus、9704、137-139（smb）,2049(NFS)端口也应被禁止,我在这写的也不全,有兴趣的朋友应该去查一下相关资料.</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">当然出入更安全的考虑你也可以包OUTPUT链设置成DROP,那你添加的规则就多一些,就像上边添加</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">允许SSH登陆一样.照着写就行了.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">下面写一下更加细致的规则,就是限制到某台机器</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如:我们只允许192.168.0.3的机器进行SSH连接</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A INPUT -s 
192.168.0.3 -p tcp --dport 22 -j ACCEPT</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent">如果要允许,或限制一段IP地址可用 
192.168.0.0/24 表示192.168.0.1-255端的所有IP.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">24表示子网掩码数.但要记得把 
/etc/sysconfig/iptables 里的这一行删了.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">-A INPUT -p tcp -m tcp 
--dport 22 -j ACCEPT 因为它表示所有地址都可以登陆.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">或采用命令方式:</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -D INPUT -p tcp 
--dport 22 -j ACCEPT</SPAN></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">然后保存,我再说一边,反是采用命令的方式,只在当时生效,如果想要重起后也起作用,那就要保存.写入到/etc/sysconfig/iptables文件里.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 18px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">#&nbsp;</SPAN>/etc/rc.d/init.d/iptables 
save</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent">这样写 !192.168.0.3 
表示除了192.168.0.3的ip地址</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">其他的规则连接也一样这么设置.</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">在下面就是FORWARD链,FORWARD链的默认规则是DROP,所以我们就写需要ACCETP(通过)的链,对正在转发链的监控.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">开启转发功能,(在做NAT时,FORWARD默认规则是DROP时,必须做)</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A FORWARD -i eth0 
-o eth1 -m state --state RELATED,ESTABLISHED -j ACCEPT</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A FORWARD -i eth1 
-o eh0 -j ACCEPT</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">丢弃坏的TCP包</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent">#iptables -A FORWARD -p 
TCP ! --syn -m state --state NEW -j DROP</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">处理IP碎片数量,防止攻击,允许每秒100个</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">#iptables -A FORWARD -f -m 
limit --limit 100/s --limit-burst 100 -j ACCEPT</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">设置ICMP包过滤,允许每秒1个包,限制触发条件是10个包.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">#iptables -A FORWARD -p icmp -m 
limit --limit 1/s --limit-burst 10 -j ACCEPT</SPAN></DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">我在前面只所以允许ICMP包通过,就是因为我在这里有限制.&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">二,配置一个NAT表放火墙</STRONG></SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">1,查看本机关于NAT的设置情况</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">[root@tp rc.d]# iptables -t nat 
-L</STRONG>&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">Chain PREROUTING (policy 
ACCEPT)&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
prot opt 
source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">Chain POSTROUTING (policy 
ACCEPT)&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent">target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
prot opt 
source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>SNAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
all&nbsp;&nbsp;&nbsp; --&nbsp;&nbsp;&nbsp; 
192.168.0.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
to:211.101.46.235</DIV>
<DIV style="-webkit-tap-highlight-color: transparent">Chain OUTPUT (policy 
ACCEPT)&nbsp;<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
prot opt 
source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
destination&nbsp;&nbsp;&nbsp;&nbsp;</DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">我的NAT已经配置好了的(只是提供最简单的代理上网功能,还没有添加防火墙规则).关于怎么配置NAT,参考我的另一篇文章</DIV>
<DIV 
style="-webkit-tap-highlight-color: transparent">当然你如果还没有配置NAT的话,你也不用清除规则,因为NAT在默认情况下是什么都没有的</DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如果你想清除,命令是</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"># iptables -F 
-t nat</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"># iptables -X 
-t nat</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"># iptables 
-<SPAN style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">Z</SPAN></SPAN></SPAN>&nbsp;-t 
nat</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"></SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">2,添加规则</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">添加基本的NAT地址转换,(关于如何配置NAT可以看我的另一篇文章),</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">添加规则,我们只添加DROP链.因为默认链全是ACCEPT.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">防止外网用内网IP欺骗</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -t nat -A PREROUTING 
-i eth0 -s 10.0.0.0/8 -j DROP<BR 
style="-webkit-tap-highlight-color: transparent"># iptables -t nat -A PREROUTING 
-i eth0 -s 172.16.0.0/12 -j DROP<BR 
style="-webkit-tap-highlight-color: transparent"># iptables -t nat -A PREROUTING 
-i eth0 -s 192.168.0.0/16 -j DROP</SPAN>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">如果我们想,比如阻止MSN,QQ,BT等的话,需要找到它们所用的端口或者IP,(个人认为没有太大必要)</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">例：</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent">
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">禁止与211.101.46.253的所有连接</STRONG></SPAN></DIV><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables&nbsp;</SPAN>-t nat 
-A PREROUTING&nbsp;&nbsp;&nbsp; -d 211.101.46.253 -j DROP<SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></SPAN></DIV>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"></P>
<DIV style="-webkit-tap-highlight-color: transparent">
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">禁用FTP(21)端口</STRONG></SPAN></SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables&nbsp;</SPAN>-t nat 
-A PREROUTING -p tcp --dport 21 -j DROP</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">这样写范围太大了,我们可以更精确的定义.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables&nbsp;</SPAN>-t nat 
-A PREROUTING&nbsp;&nbsp;&nbsp; -p tcp --dport 21 -d 211.101.46.253 -j 
DROP</SPAN></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 10pt; -webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">这样只禁用211.101.46.253地址的FTP连接,其他连接还可以.如web(80端口)连接.</STRONG></SPAN></DIV></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">按照我写的,你只要找到QQ,MSN等其他软件的IP地址,和端口,以及基于什么协议,只要照着写就行了.</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">最后：</STRONG></DIV>
<DIV style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">drop非法连接</STRONG>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables -A 
INPUT&nbsp;&nbsp;&nbsp;&nbsp; -m state --state INVALID -j DROP<BR 
style="-webkit-tap-highlight-color: transparent"># iptables -A 
OUTPUT&nbsp;&nbsp;&nbsp; -m state --state INVALID -j DROP<BR 
style="-webkit-tap-highlight-color: transparent"># iptables-A FORWARD -m state 
--state INVALID -j DROP</SPAN>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><STRONG 
style="-webkit-tap-highlight-color: transparent">允许所有已经建立的和相关的连接</STRONG>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR 
style="-webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent"># iptables-A INPUT -m state 
--state ESTABLISHED,RELATED -j ACCEPT<BR 
style="-webkit-tap-highlight-color: transparent"># iptables-A OUTPUT -m state 
--state ESTABLISHED,RELATED -j ACCEPT<BR 
style="-webkit-tap-highlight-color: transparent"></SPAN></DIV>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><SPAN 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 18px; -webkit-tap-highlight-color: transparent"><SPAN 
style="-webkit-tap-highlight-color: transparent">#&nbsp;</SPAN>/etc/rc.d/init.d/iptables 
save</SPAN></P>
<P style="MARGIN-BOTTOM: 16px; -webkit-tap-highlight-color: transparent"><BR 
style="-webkit-tap-highlight-color: transparent"></P><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN><SPAN 
style="-webkit-tap-highlight-color: transparent"></SPAN></DIV></DIV>
<DIV class=blog-opr 
style='FONT-SIZE: 16px; FONT-FAMILY: "Pingfang SC", STHeiti, "Lantinghei SC", "Open Sans", Arial, "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", SimSun, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; BORDER-BOTTOM: rgb(204,204,204) 1px solid; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); PADDING-BOTTOM: 17px; FONT-STYLE: normal; TEXT-ALIGN: right; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(248,248,248); TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-tap-highlight-color: transparent'><BR 
class=Apple-interchange-newline></DIV>
</BODY>
</HTML>

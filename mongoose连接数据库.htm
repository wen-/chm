<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>mongoose连接数据库</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META name=GENERATOR content="MSHTML 11.00.9600.17801"></HEAD>
<BODY>
<P>mongoose连接数据库</P>
<P>&nbsp;</P><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">mongoose </SPAN>= require(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'mongoose'</SPAN>);<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">exports</SPAN>.<SPAN style="FONT-WEIGHT: bold">Db </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">mongoose</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">createConnection</SPAN>();//方法一</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="COLOR: #808080; FONT-STYLE: italic">/*mongoose.connect('mongodb://localhost/myblog',function(){<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">    console.log("</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">数据库连接成功！</SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">");<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">});*///'mongodb://"user":"pass"@localhost/myblog' 方法二</SPAN></PRE><BR></PRE><SPAN 
style="COLOR: #808080; FONT-STYLE: italic"><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">options </SPAN>= {<BR>    <SPAN style="FONT-WEIGHT: bold">db</SPAN>: { <SPAN style="FONT-WEIGHT: bold">native_parser</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">true </SPAN>}<BR>    ,<SPAN style="FONT-WEIGHT: bold">server</SPAN>: { <SPAN style="FONT-WEIGHT: bold">poolSize</SPAN>: <SPAN style="COLOR: #6666d9">5 </SPAN>}<BR>    ,<SPAN style="FONT-WEIGHT: bold">user</SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'' //用户名</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN><SPAN style="COLOR: #ccffff">    </SPAN>,<SPAN style="FONT-WEIGHT: bold">pass</SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'' //密码</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN>};<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">isDev </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">true</SPAN>;<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">host </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">isDev </SPAN>? <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'localhost'</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'mongo.duapp.com'</SPAN>;<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">port </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">isDev </SPAN>? <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'27017'</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'8908'</SPAN>;<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">database </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">isDev </SPAN>? <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'myblog'</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'bae mongdb database'</SPAN>;<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">user </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">isDev </SPAN>? <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">''</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'bae api key'</SPAN>;<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">pass </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">isDev </SPAN>? <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">''</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'bae api secret'</SPAN>;<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">open</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">host</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">database</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">port</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">options</SPAN>);<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic"></SPAN></PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">on</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'error'</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>    <SPAN style="COLOR: #808080; FONT-STYLE: italic">//logger.error("connect error :" + err);<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">    //</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">监听</SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">BAE mongodb</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">异常后关闭闲置连接<BR></SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">    </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #ccffff; BACKGROUND-COLOR: #333333">出错了</SPAN><SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN>);<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">close</SPAN>();<BR>});<BR><SPAN style="COLOR: #808080; FONT-STYLE: italic">//</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">监听</SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">db close event</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #808080; FONT-STYLE: italic">并重新连接<BR></SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">on</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'close'</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>() {<BR>    <SPAN style="COLOR: #808080; FONT-STYLE: italic">//logger.info("connect close retry connect ");<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">    </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #ccffff; BACKGROUND-COLOR: #333333">重新连接</SPAN><SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN>);<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">open</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">host</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">database</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">port</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">options</SPAN>);<BR>});</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">userSchema </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">mongoose</SPAN>.<SPAN style="FONT-WEIGHT: bold">Schema</SPAN>({//创建表结构<BR>    <SPAN style="FONT-WEIGHT: bold">name</SPAN>: String,<BR>    <SPAN style="FONT-WEIGHT: bold">password</SPAN>: String,<BR>    <SPAN style="FONT-WEIGHT: bold">email</SPAN>: String,<BR>    <SPAN style="FONT-WEIGHT: bold">head</SPAN>: String<BR>}, {<BR>    <SPAN style="FONT-WEIGHT: bold">collection</SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'users'//表名,此处优先级高会取代model定义的‘User’(users表名)</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN>});</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><BR>&nbsp;</PRE><FONT color=#808080></FONT></PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="COLOR: #808080; FONT-STYLE: italic">//var userModel = mongoose.model('User', userSchema);//方法二的就用这个</SPAN><BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">userModel </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">model</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'User'</SPAN>, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">userSchema</SPAN>);//关键是这句mongoose创建连接的对象赋给了db,所以要用db.model，</PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525">另外‘User’为表名（对应数据库的表名为users.转小写后面加上s）</PRE></PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><BR><BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>User(<SPAN style="COLOR: #99ff99">user</SPAN>) {<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">name </SPAN>= <SPAN style="COLOR: #99ff99">user</SPAN>.<SPAN style="FONT-WEIGHT: bold">name</SPAN>;<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">password </SPAN>= <SPAN style="COLOR: #99ff99">user</SPAN>.<SPAN style="FONT-WEIGHT: bold">password</SPAN>;<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">email </SPAN>= <SPAN style="COLOR: #99ff99">user</SPAN>.<SPAN style="FONT-WEIGHT: bold">email</SPAN>;<BR>};<BR><BR>User.<SPAN style="FONT-WEIGHT: bold">prototype</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">save </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(<SPAN style="COLOR: #99ff99">callback</SPAN>) {<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">//md5 = crypto.createHash('md5'),<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">        //email_MD5 = md5.update(this.email.toLowerCase()).digest('hex'),<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">        //head = "http://www.gravatar.com/avatar/" + email_MD5 + "?s=48";<BR></SPAN><SPAN style="COLOR: #808080; FONT-STYLE: italic">        </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">head </SPAN>= <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"http://www.gravatar.com/avatar?s=48"</SPAN>;<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">user </SPAN>= {<BR>        <SPAN style="FONT-WEIGHT: bold">name</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">name</SPAN>,<BR>        <SPAN style="FONT-WEIGHT: bold">password</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">password</SPAN>,<BR>        <SPAN style="FONT-WEIGHT: bold">email</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">email</SPAN>,<BR>        <SPAN style="FONT-WEIGHT: bold">head</SPAN>: <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">head<BR></SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">    </SPAN>};<BR><BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newUser </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">userModel</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">user</SPAN>);<BR><BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">newUser</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">save</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>) {<BR>        <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>            <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">return </SPAN><SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>);<BR>        }<BR>        <SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">null</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>);<BR>    });<BR>};<BR><BR>User.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">get </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(<SPAN style="COLOR: #99ff99">name</SPAN>, <SPAN style="COLOR: #99ff99">callback</SPAN>) {<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">userModel</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">findOne</SPAN>({<SPAN style="FONT-WEIGHT: bold">name</SPAN>: <SPAN style="COLOR: #99ff99">name</SPAN>}, <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>) {<BR>        <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>            <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">return </SPAN><SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>);<BR>        }<BR>        <SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">null</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>);<BR>    });<BR>};<BR><BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">uu </SPAN>= {<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #ccffff; BACKGROUND-COLOR: #333333">"name"</SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #ccffff; BACKGROUND-COLOR: #333333">小</SPAN><SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">d"</SPAN>,<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #ccffff; BACKGROUND-COLOR: #333333">"password"</SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"123456"</SPAN>,<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #ccffff; BACKGROUND-COLOR: #333333">"email"</SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #ccffff"> </SPAN>: <SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"yellowwen@126.com"</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN>};<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">db</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">on</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">'open'</SPAN>,<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(){<BR><BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">var </SPAN><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">ua </SPAN>= <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">new </SPAN>User(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">uu</SPAN>);<BR><SPAN style="FONT-WEIGHT: bold; COLOR: #99ff99">ua</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">save</SPAN>(<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">function</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>,<SPAN style="COLOR: #99ff99">user</SPAN>){<BR>    <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">if</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>){<BR>        <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #ccffff; BACKGROUND-COLOR: #333333">保存出错！</SPAN><SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN>);<BR>        <SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">return false</SPAN>;<BR>    }<SPAN style="FONT-WEIGHT: bold; COLOR: #99ffdd">else</SPAN>{<BR>        <SPAN style="FONT-WEIGHT: bold; COLOR: #99ccff; FONT-STYLE: italic">console</SPAN>.<SPAN style="COLOR: #95c995; FONT-STYLE: italic">log</SPAN>(<SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">"</SPAN><SPAN style="FONT-FAMILY: '宋体'; COLOR: #ccffff; BACKGROUND-COLOR: #333333">保存成功</SPAN><SPAN style="COLOR: #ccffff; BACKGROUND-COLOR: #333333">---"</SPAN>+<SPAN style="COLOR: #99ff99">user</SPAN>);<BR>    }<BR>});<BR><BR>});<BR></PRE><PRE style="FONT-SIZE: 14pt; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; BACKGROUND-COLOR: #282525"><SPAN style="COLOR: #808080; FONT-STYLE: italic">//module.exports = User;</SPAN></PRE><BR></PRE></SPAN></BODY></HTML>

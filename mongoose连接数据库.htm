<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>mongoose连接数据库</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META name=GENERATOR content="MSHTML 8.00.6001.23580">
</HEAD>
<BODY>
<P>mongoose连接数据库</P>
<P>&nbsp;</P><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">mongoose </SPAN>= require(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'mongoose'</SPAN>);<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">exports</SPAN>.<SPAN style="FONT-WEIGHT: bold">Db </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">mongoose</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">createConnection</SPAN>();//方法一</PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><SPAN style="FONT-STYLE: italic; COLOR: #808080">/*mongoose.connect('mongodb://localhost/myblog',function(){<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">    console.log("</SPAN><SPAN style="FONT-STYLE: italic; FONT-FAMILY: '宋体'; COLOR: #808080">数据库连接成功！</SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">");<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">});*///'mongodb://"user":"pass"@localhost/myblog' 方法二</SPAN></PRE><BR></PRE><SPAN 
style="FONT-STYLE: italic; COLOR: #808080"><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">options </SPAN>= {<BR>    <SPAN style="FONT-WEIGHT: bold">db</SPAN>: { <SPAN style="FONT-WEIGHT: bold">native_parser</SPAN>: <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">true </SPAN>}<BR>    ,<SPAN style="FONT-WEIGHT: bold">server</SPAN>: { <SPAN style="FONT-WEIGHT: bold">poolSize</SPAN>: <SPAN style="COLOR: #6666d9">5 </SPAN>}<BR>    ,<SPAN style="FONT-WEIGHT: bold">user</SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'' //用户名</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN><SPAN style="COLOR: #ccffff">    </SPAN>,<SPAN style="FONT-WEIGHT: bold">pass</SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'' //密码</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN>};<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">isDev </SPAN>= <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">true</SPAN>;<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">host </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">isDev </SPAN>? <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'localhost'</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'mongo.duapp.com'</SPAN>;<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">port </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">isDev </SPAN>? <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'27017'</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'8908'</SPAN>;<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">database </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">isDev </SPAN>? <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'myblog'</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'bae mongdb database'</SPAN>;<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">user </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">isDev </SPAN>? <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">''</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'bae api key'</SPAN>;<BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">pass </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">isDev </SPAN>? <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">''</SPAN><SPAN style="COLOR: #ccffff"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'bae api secret'</SPAN>;<BR><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">open</SPAN>(<SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">host</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">database</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">port</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">options</SPAN>);<BR><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold"></SPAN></PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">on</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'error'</SPAN>, <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>    <SPAN style="FONT-STYLE: italic; COLOR: #808080">//logger.error("connect error :" + err);<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">    //</SPAN><SPAN style="FONT-STYLE: italic; FONT-FAMILY: '宋体'; COLOR: #808080">监听</SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">BAE mongodb</SPAN><SPAN style="FONT-STYLE: italic; FONT-FAMILY: '宋体'; COLOR: #808080">异常后关闭闲置连接<BR></SPAN><SPAN style="FONT-STYLE: italic; FONT-FAMILY: '宋体'; COLOR: #808080">    </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">console</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">log</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN><SPAN style="BACKGROUND-COLOR: #333333; FONT-FAMILY: '宋体'; COLOR: #ccffff">出错了</SPAN><SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN>);<BR>    <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">close</SPAN>();<BR>});<BR><SPAN style="FONT-STYLE: italic; COLOR: #808080">//</SPAN><SPAN style="FONT-STYLE: italic; FONT-FAMILY: '宋体'; COLOR: #808080">监听</SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">db close event</SPAN><SPAN style="FONT-STYLE: italic; FONT-FAMILY: '宋体'; COLOR: #808080">并重新连接<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">on</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'close'</SPAN>, <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function </SPAN>() {<BR>    <SPAN style="FONT-STYLE: italic; COLOR: #808080">//logger.info("connect close retry connect ");<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">    </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">console</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">log</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN><SPAN style="BACKGROUND-COLOR: #333333; FONT-FAMILY: '宋体'; COLOR: #ccffff">重新连接</SPAN><SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN>);<BR>    <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">open</SPAN>(<SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">host</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">database</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">port</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">options</SPAN>);<BR>});</PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">userSchema </SPAN>= <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">new </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">mongoose</SPAN>.<SPAN style="FONT-WEIGHT: bold">Schema</SPAN>({//创建表结构<BR>    <SPAN style="FONT-WEIGHT: bold">name</SPAN>: String,<BR>    <SPAN style="FONT-WEIGHT: bold">password</SPAN>: String,<BR>    <SPAN style="FONT-WEIGHT: bold">email</SPAN>: String,<BR>    <SPAN style="FONT-WEIGHT: bold">head</SPAN>: String<BR>}, {<BR>    <SPAN style="FONT-WEIGHT: bold">collection</SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'users'//表名</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN>});</PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><BR>&nbsp;</PRE><FONT color=#808080></FONT></PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><SPAN style="FONT-STYLE: italic; COLOR: #808080">//var userModel = mongoose.model('User', userSchema);//方法二的就用这个</SPAN><BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">userModel </SPAN>= <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">model</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'User'</SPAN>, <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">userSchema</SPAN>);//关键是这句mongoose创建连接的对象赋给了db,所以要用db.model</PRE></PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><BR><BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function </SPAN>User(<SPAN style="COLOR: #99ff99">user</SPAN>) {<BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">name </SPAN>= <SPAN style="COLOR: #99ff99">user</SPAN>.<SPAN style="FONT-WEIGHT: bold">name</SPAN>;<BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">password </SPAN>= <SPAN style="COLOR: #99ff99">user</SPAN>.<SPAN style="FONT-WEIGHT: bold">password</SPAN>;<BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">email </SPAN>= <SPAN style="COLOR: #99ff99">user</SPAN>.<SPAN style="FONT-WEIGHT: bold">email</SPAN>;<BR>};<BR><BR>User.<SPAN style="FONT-WEIGHT: bold">prototype</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">save </SPAN>= <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function</SPAN>(<SPAN style="COLOR: #99ff99">callback</SPAN>) {<BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">//md5 = crypto.createHash('md5'),<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">        //email_MD5 = md5.update(this.email.toLowerCase()).digest('hex'),<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">        //head = "http://www.gravatar.com/avatar/" + email_MD5 + "?s=48";<BR></SPAN><SPAN style="FONT-STYLE: italic; COLOR: #808080">        </SPAN><SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">head </SPAN>= <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"http://www.gravatar.com/avatar?s=48"</SPAN>;<BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">user </SPAN>= {<BR>        <SPAN style="FONT-WEIGHT: bold">name</SPAN>: <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">name</SPAN>,<BR>        <SPAN style="FONT-WEIGHT: bold">password</SPAN>: <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">password</SPAN>,<BR>        <SPAN style="FONT-WEIGHT: bold">email</SPAN>: <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">this</SPAN>.<SPAN style="FONT-WEIGHT: bold">email</SPAN>,<BR>        <SPAN style="FONT-WEIGHT: bold">head</SPAN>: <SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">head<BR></SPAN><SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">    </SPAN>};<BR><BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">newUser </SPAN>= <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">new </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">userModel</SPAN>(<SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">user</SPAN>);<BR><BR>    <SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">newUser</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">save</SPAN>(<SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>) {<BR>        <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">if </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>            <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">return </SPAN><SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>);<BR>        }<BR>        <SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">null</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>);<BR>    });<BR>};<BR><BR>User.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">get </SPAN>= <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function</SPAN>(<SPAN style="COLOR: #99ff99">name</SPAN>, <SPAN style="COLOR: #99ff99">callback</SPAN>) {<BR>    <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">userModel</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">findOne</SPAN>({<SPAN style="FONT-WEIGHT: bold">name</SPAN>: <SPAN style="COLOR: #99ff99">name</SPAN>}, <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>) {<BR>        <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">if </SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>) {<BR>            <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">return </SPAN><SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>);<BR>        }<BR>        <SPAN style="COLOR: #99ff99">callback</SPAN>(<SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">null</SPAN>, <SPAN style="COLOR: #99ff99">user</SPAN>);<BR>    });<BR>};<BR><BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">uu </SPAN>= {<BR>    <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff; FONT-WEIGHT: bold">"name"</SPAN><SPAN style="COLOR: #ccffff; FONT-WEIGHT: bold"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN><SPAN style="BACKGROUND-COLOR: #333333; FONT-FAMILY: '宋体'; COLOR: #ccffff">小</SPAN><SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">d"</SPAN>,<BR>    <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff; FONT-WEIGHT: bold">"password"</SPAN><SPAN style="COLOR: #ccffff; FONT-WEIGHT: bold"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"123456"</SPAN>,<BR>    <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff; FONT-WEIGHT: bold">"email"</SPAN><SPAN style="COLOR: #ccffff; FONT-WEIGHT: bold"> </SPAN>: <SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"yellowwen@126.com"</SPAN><SPAN style="COLOR: #ccffff"><BR></SPAN>};<BR><SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">db</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">on</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">'open'</SPAN>,<SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function</SPAN>(){<BR><BR><SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">var </SPAN><SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">ua </SPAN>= <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">new </SPAN>User(<SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">uu</SPAN>);<BR><SPAN style="COLOR: #99ff99; FONT-WEIGHT: bold">ua</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">save</SPAN>(<SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">function</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>,<SPAN style="COLOR: #99ff99">user</SPAN>){<BR>    <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">if</SPAN>(<SPAN style="COLOR: #99ff99">err</SPAN>){<BR>        <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">console</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">log</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN><SPAN style="BACKGROUND-COLOR: #333333; FONT-FAMILY: '宋体'; COLOR: #ccffff">保存出错！</SPAN><SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN>);<BR>        <SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">return false</SPAN>;<BR>    }<SPAN style="COLOR: #99ffdd; FONT-WEIGHT: bold">else</SPAN>{<BR>        <SPAN style="FONT-STYLE: italic; COLOR: #99ccff; FONT-WEIGHT: bold">console</SPAN>.<SPAN style="FONT-STYLE: italic; COLOR: #95c995">log</SPAN>(<SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">"</SPAN><SPAN style="BACKGROUND-COLOR: #333333; FONT-FAMILY: '宋体'; COLOR: #ccffff">保存成功</SPAN><SPAN style="BACKGROUND-COLOR: #333333; COLOR: #ccffff">---"</SPAN>+<SPAN style="COLOR: #99ff99">user</SPAN>);<BR>    }<BR>});<BR><BR>});<BR></PRE><PRE style="BACKGROUND-COLOR: #282525; FONT-FAMILY: 'Source Code Pro Semibold'; COLOR: #ffffff; FONT-SIZE: 14pt"><SPAN style="FONT-STYLE: italic; COLOR: #808080">//module.exports = User;</SPAN></PRE><BR></PRE></SPAN></BODY></HTML>